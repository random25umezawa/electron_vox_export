<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    <script>
      const {remote,ipcRenderer} = require("electron")
      const {BrowserWindow,dialog} = remote;
      ipcRenderer.on("send",(e,arg)=>{
        console.log(arg)
      })
      ipcRenderer.send("get","we--i")
    </script>
  </head>
  <body>


    <div id="area"></div>
    <div id="image_area"></div>
    <script>
      let image_area = document.querySelector("#image_area")
      let area = document.querySelector("#area")
      let input = document.createElement("input");
      let button = document.createElement("button");
      button.innerText = "we---i"
      button.onclick = function() {
        let val = input.value;
        ipcRenderer.send("get",val);
      }
      let file_input = document.createElement("input");
      file_input.type="file"
      file_input.onchange = function(e) {
        if(timer) clearTimeout(timer)
        ipcRenderer.send("setFile",e.target.files[0].path);
      }
      area.appendChild(input)
      area.appendChild(button)
      area.appendChild(file_input)

      let timer;

      ipcRenderer.on("setFileComplete",(e,arg)=>{
        image_area.innerHTML = "";
        let r_count = 0;
        let time = +new Date();
        if(timer) clearTimeout(timer)

        //cache
        let images = [...Array(arg).keys()].map(index=>{
          let img = document.createElement("img");
          img.src=`./temp_export/${`${index}`.padStart(3,"0")}.png?${time}`;
          img.style.display = "none";
          return img;
        })
        for(let img of images) image_area.appendChild(img);

        let img = document.createElement("img");
        timer = setInterval(
          _=>{
            img.src=`./temp_export/${`${((r_count++)%arg)}`.padStart(3,"0")}.png?${time}`;
          }
          ,125
        )
        image_area.appendChild(img);
      })
    </script>
  </body>
</html>
